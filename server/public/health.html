<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>System Health Dashboard</title>
  <script>
    window.APP_CONFIG = {
      baseURL: window.location.origin + "/v1"
    };
  </script>
  <style>
    :root {
      --primary: #3498db;
      --secondary: #2c3e50;
      --success: #27ae60;
      --danger: #e74c3c;
      --warning: #f39c12;
      --info: #17a2b8;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #95a5a6;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a2a3a, #2c3e50);
      color: white;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .logo {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
    }

    .timestamp {
      font-size: 14px;
      color: var(--gray);
    }

    .refresh-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .refresh-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
    }

    .card-icon {
      font-size: 24px;
    }

    .info-grid {
      display: grid;
      gap: 10px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.5s ease;
    }

    .info-label {
      color: var(--gray);
    }

    .info-value {
      font-weight: 600;
      transition: all 0.5s ease;
    }

    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      margin-top: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1.5s ease-in-out;
    }

    .cpu-progress {
      background: linear-gradient(90deg, var(--success), var(--warning));
    }

    .memory-progress {
      background: linear-gradient(90deg, var(--primary), var(--info));
    }

    .storage-progress {
      background: linear-gradient(90deg, var(--warning), var(--danger));
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-online {
      background: var(--success);
      box-shadow: 0 0 10px var(--success);
    }

    .status-warning {
      background: var(--warning);
      box-shadow: 0 0 10px var(--warning);
    }

    .status-offline {
      background: var(--danger);
      box-shadow: 0 0 10px var(--danger);
    }

    .gpu-list,
    .storage-list,
    .network-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .gpu-item,
    .storage-item,
    .network-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      transition: all 0.5s ease;
    }

    .gpu-item:last-child,
    .storage-item:last-child,
    .network-item:last-child {
      margin-bottom: 0;
    }

    .process-stats {
      display: flex;
      justify-content: space-around;
      text-align: center;
    }

    .process-stat {
      padding: 10px;
      transition: all 0.5s ease;
    }

    .process-count {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
      transition: all 0.5s ease;
    }

    .process-label {
      font-size: 12px;
      color: var(--gray);
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: var(--gray);
    }

    .error {
      background: var(--danger);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      margin: 20px 0;
    }

    .update-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .updating .update-indicator {
      opacity: 1;
      animation: pulse 1.5s infinite;
    }

    .value-updated {
      animation: highlight 1.5s ease;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.7;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes highlight {
      0% {
        background-color: rgba(52, 152, 219, 0.3);
      }

      100% {
        background-color: transparent;
      }
    }

    .smooth-transition {
      transition: all 1.5s ease-in-out;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .dashboard {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div class="logo">System Health Dashboard</div>
        <div class="timestamp" id="timestamp">Loading...</div>
        <button class="refresh-btn" id="refreshBtn">
          <span id="refreshText">Auto Refresh: ON</span>
          <span id="refreshIcon">‚Üª</span>
        </button>
      </div>
    </header>

    <div id="dashboard" class="dashboard">
      <div class="loading">Loading system health data...</div>
    </div>
  </div>

  <script>
    const dashboard = document.getElementById('dashboard')
    const timestamp = document.getElementById('timestamp')
    const refreshBtn = document.getElementById('refreshBtn')
    const refreshText = document.getElementById('refreshText')
    const refreshIcon = document.getElementById('refreshIcon')

    // Base URL
    const baseURL = window.APP_CONFIG.baseURL;


    // Oldingi ma'lumotlarni saqlash
    let previousData = null
    let autoRefreshEnabled = true

    // Ma'lumotlarni olish funksiyasi
    async function fetchSystemHealth() {
      try {
        // Yangilanish holatini ko'rsatish (sezilmas)
        if (previousData) {
          document.querySelectorAll('.card').forEach(card => {
            card.classList.add('updating')
          })
        }

        const response = await fetch(`${baseURL}/health`)

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`)
        }

        const data = await response.json()

        // Dashboardni yangilash (sezilmas animatsiya bilan)
        await updateDashboardSmoothly(data)

        // Timestampni yangilash
        const now = new Date()
        timestamp.textContent = `Last updated: ${now.toLocaleString()}`

        // Yangilanish holatini olib tashlash
        setTimeout(() => {
          document.querySelectorAll('.card').forEach(card => {
            card.classList.remove('updating')
          })
        }, 1000)
      } catch (error) {
        console.error('Error fetching system health:', error)
        if (!previousData) {
          dashboard.innerHTML = `
                        <div class="error">
                            <h3>Failed to retrieve system health data</h3>
                            <p>${error.message}</p>
                            <p>Please check if the server is running and try again.</p>
                        </div>
                    `
        }
      } finally {
        // Refresh tugmasini qayta faollashtirish
        refreshBtn.disabled = false
      }
    }

    // Sezilmas yangilash funksiyasi
    async function updateDashboardSmoothly(newData) {
      if (!previousData) {
        // Birinchi marta yuklash
        updateDashboard(newData)
        previousData = newData
        return
      }

      // Elementlarni topish
      const cards = document.querySelectorAll('.card')
      if (cards.length === 0) {
        updateDashboard(newData)
        previousData = newData
        return
      }

      // Progress barlarni yangilash
      updateProgressBars(newData)

      // Qiymatlarni yangilash (faqat o'zgarganlarini)
      updateValuesSmoothly(newData)

      previousData = newData
    }

    // Progress barlarni yangilash
    function updateProgressBars(data) {
      // CPU load
      const cpuProgress = document.querySelector('.cpu-progress')
      if (cpuProgress) {
        cpuProgress.style.width = `${parseFloat(data.cpu.load)}%`
      }

      // Memory usage
      const memoryProgress = document.querySelector('.memory-progress')
      if (memoryProgress) {
        memoryProgress.style.width = `${parseFloat(data.memory.usage)}%`
      }
    }

    // Qiymatlarni sezilmas yangilash
    function updateValuesSmoothly(data) {
      // System info
      updateValueIfChanged('system.platform', data.system.platform)
      updateValueIfChanged('system.hostname', data.system.hostname)
      updateValueIfChanged('system.release', data.system.release)
      updateValueIfChanged('system.architecture', data.system.architecture)
      updateValueIfChanged('system.uptime', data.system.uptime)

      // CPU info
      updateValueIfChanged('cpu.manufacturer', data.cpu.manufacturer)
      updateValueIfChanged('cpu.brand', data.cpu.brand)
      updateValueIfChanged(
        'cpu.cores',
        `${data.cpu.cores} (${data.cpu.physicalCores} physical)`
      )
      updateValueIfChanged('cpu.speed', data.cpu.speed)
      updateValueIfChanged('cpu.load', data.cpu.load)

      // Memory info
      updateValueIfChanged('memory.total', data.memory.total)
      updateValueIfChanged('memory.used', data.memory.used)
      updateValueIfChanged('memory.free', data.memory.free)
      updateValueIfChanged('memory.usage', data.memory.usage)

      // Processes
      updateValueIfChanged(
        'processes.all',
        data.processes.all.toString(),
        true
      )
      updateValueIfChanged(
        'processes.running',
        data.processes.running.toString(),
        true
      )
      updateValueIfChanged(
        'processes.blocked',
        data.processes.blocked.toString(),
        true
      )
    }

    // Agar qiymat o'zgarganda yangilash
    function updateValueIfChanged(key, newValue, isProcess = false) {
      const oldValue = getNestedValue(previousData, key)

      if (oldValue !== newValue) {
        let element

        if (isProcess) {
          // Process count elementlari
          element = document.querySelector(`[data-key="${key}"]`)
        } else {
          // Boshqa elementlar
          element = document.querySelector(`[data-key="${key}"]`)
        }

        if (element) {
          // Sezilmas o'tish animatsiyasi
          element.style.opacity = '0.7'
          setTimeout(() => {
            element.textContent = newValue
            element.style.opacity = '1'
            element.classList.add('value-updated')
            setTimeout(() => {
              element.classList.remove('value-updated')
            }, 1500)
          }, 300)
        }
      }
    }

    // Nested object qiymatini olish
    function getNestedValue(obj, path) {
      return path.split('.').reduce((current, key) => {
        return current ? current[key] : undefined
      }, obj)
    }

    // Dashboardni yangilash funksiyasi (birinchi marta)
    function updateDashboard(data) {
      dashboard.innerHTML = `
                <!-- System Info Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">System Information</div>
                        <div class="card-icon">üñ•Ô∏è</div>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Platform</span>
                            <span class="info-value" data-key="system.platform">${data.system.platform
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Hostname</span>
                            <span class="info-value" data-key="system.hostname">${data.system.hostname
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Release</span>
                            <span class="info-value" data-key="system.release">${data.system.release
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Architecture</span>
                            <span class="info-value" data-key="system.architecture">${data.system.architecture
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Uptime</span>
                            <span class="info-value" data-key="system.uptime">${data.system.uptime
        }</span>
                        </div>
                    </div>
                </div>
                
                <!-- CPU Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">CPU</div>
                        <div class="card-icon">üöÄ</div>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Manufacturer</span>
                            <span class="info-value" data-key="cpu.manufacturer">${data.cpu.manufacturer
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Model</span>
                            <span class="info-value" data-key="cpu.brand">${data.cpu.brand
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Cores</span>
                            <span class="info-value" data-key="cpu.cores">${data.cpu.cores
        } (${data.cpu.physicalCores} physical)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Speed</span>
                            <span class="info-value" data-key="cpu.speed">${data.cpu.speed
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Current Load</span>
                            <span class="info-value" data-key="cpu.load">${data.cpu.load
        }</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill cpu-progress" style="width: ${parseFloat(
          data.cpu.load
        )}%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Memory Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">Memory</div>
                        <div class="card-icon">üíæ</div>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Total</span>
                            <span class="info-value" data-key="memory.total">${data.memory.total
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Used</span>
                            <span class="info-value" data-key="memory.used">${data.memory.used
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Free</span>
                            <span class="info-value" data-key="memory.free">${data.memory.free
        }</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Usage</span>
                            <span class="info-value" data-key="memory.usage">${data.memory.usage
        }</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill memory-progress" style="width: ${parseFloat(
          data.memory.usage
        )}%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- GPU Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">Graphics</div>
                        <div class="card-icon">üéÆ</div>
                    </div>
                    <div class="gpu-list">
                        ${data.gpu
          .map(
            gpu => `
                            <div class="gpu-item">
                                <div class="info-item">
                                    <span class="info-label">Model</span>
                                    <span class="info-value">${gpu.model}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Vendor</span>
                                    <span class="info-value">${gpu.vendor}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">VRAM</span>
                                    <span class="info-value">${gpu.vram}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Bus</span>
                                    <span class="info-value">${gpu.bus}</span>
                                </div>
                            </div>
                        `
          )
          .join('')}
                    </div>
                </div>
                
                <!-- Storage Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">Storage</div>
                        <div class="card-icon">üíΩ</div>
                    </div>
                    <div class="storage-list">
                        ${data.storage
          .map(
            disk => `
                            <div class="storage-item">
                                <div class="info-item">
                                    <span class="info-label">Device</span>
                                    <span class="info-value">${disk.device}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Name</span>
                                    <span class="info-value">${disk.name}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Size</span>
                                    <span class="info-value">${disk.size}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Type</span>
                                    <span class="info-value">${disk.type}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Interface</span>
                                    <span class="info-value">${disk.interfaceType}</span>
                                </div>
                            </div>
                        `
          )
          .join('')}
                    </div>
                </div>
                
                <!-- Network Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">Network</div>
                        <div class="card-icon">üåê</div>
                    </div>
                    <div class="network-list">
                        ${data.network
          .map(
            net => `
                            <div class="network-item">
                                <div class="info-item">
                                    <span class="info-label">Interface</span>
                                    <span class="info-value">${net.iface}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">IP Address</span>
                                    <span class="info-value">${net.ip4}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">MAC</span>
                                    <span class="info-value">${net.mac}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Speed</span>
                                    <span class="info-value">${net.speed}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Internal</span>
                                    <span class="info-value">${net.internal ? 'Yes' : 'No'
              }</span>
                                </div>
                            </div>
                        `
          )
          .join('')}
                    </div>
                </div>
                
                <!-- Processes Card -->
                <div class="card">
                    <div class="update-indicator"></div>
                    <div class="card-header">
                        <div class="card-title">Processes</div>
                        <div class="card-icon">‚öôÔ∏è</div>
                    </div>
                    <div class="process-stats">
                        <div class="process-stat">
                            <div class="process-count" data-key="processes.all">${data.processes.all
        }</div>
                            <div class="process-label">Total</div>
                        </div>
                        <div class="process-stat">
                            <div class="process-count" data-key="processes.running">${data.processes.running
        }</div>
                            <div class="process-label">Running</div>
                        </div>
                        <div class="process-stat">
                            <div class="process-count" data-key="processes.blocked">${data.processes.blocked
        }</div>
                            <div class="process-label">Blocked</div>
                        </div>
                    </div>
                </div>
            `
    }

    // Refresh tugmasi bosilganda
    refreshBtn.addEventListener('click', () => {
      autoRefreshEnabled = !autoRefreshEnabled
      if (autoRefreshEnabled) {
        refreshText.textContent = 'Auto Refresh: ON'
        refreshBtn.style.background = 'var(--primary)'
      } else {
        refreshText.textContent = 'Auto Refresh: OFF'
        refreshBtn.style.background = 'var(--gray)'
      }
      fetchSystemHealth()
    })

    // Avtomatik yangilash (har 5 sekundda - sezilmas)
    setInterval(() => {
      if (autoRefreshEnabled) {
        fetchSystemHealth()
      }
    }, 5000)

    // Dastlabki ma'lumotlarni yuklash
    fetchSystemHealth()
  </script>
</body>

</html>